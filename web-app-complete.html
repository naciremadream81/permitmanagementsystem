<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Permit Management System - Complete</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            color: #4a5568;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .header p {
            text-align: center;
            color: #718096;
        }
        
        .auth-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            background: #f7fafc;
        }
        
        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            background: transparent;
            font-size: 16px;
            font-weight: 500;
        }
        
        .auth-tab.active {
            background: #4299e1;
            color: white;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #4a5568;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #4299e1;
        }
        
        .btn {
            background: #4299e1;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .btn:hover {
            background: #3182ce;
            color: white;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #718096;
        }
        
        .btn-secondary:hover {
            background: #4a5568;
        }
        
        .main-content {
            display: none;
        }
        
        .main-content.active {
            display: block;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .dashboard-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .dashboard-card h3 {
            color: #4a5568;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .county-selector {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .county-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .checklist-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .checklist-item:hover {
            border-color: #4299e1;
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.2);
        }
        
        .checklist-item.completed {
            border-color: #48bb78;
            background: #f0fff4;
        }
        
        .checklist-item input[type="checkbox"] {
            margin-right: 15px;
            transform: scale(1.2);
        }
        
        .checklist-item-content {
            flex: 1;
        }
        
        .checklist-item-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }
        
        .checklist-item-description {
            color: #718096;
            font-size: 14px;
        }
        
        .file-upload-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .file-upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .file-upload-area:hover {
            border-color: #4299e1;
            background: #f7fafc;
        }
        
        .file-upload-area.dragover {
            border-color: #4299e1;
            background: #ebf8ff;
        }
        
        .file-list {
            margin-top: 20px;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .file-icon {
            width: 40px;
            height: 40px;
            background: #4299e1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .file-details h4 {
            margin-bottom: 5px;
            color: #2d3748;
        }
        
        .file-details p {
            color: #718096;
            font-size: 14px;
        }
        
        .file-actions button {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .user-info {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .user-info h3 {
            color: #4a5568;
            margin-bottom: 15px;
        }
        
        .user-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .user-detail {
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
        }
        
        .user-detail label {
            font-weight: 600;
            color: #4a5568;
            display: block;
            margin-bottom: 5px;
        }
        
        .user-detail span {
            color: #2d3748;
        }
        
        .logout-btn {
            background: #e53e3e;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 15px;
        }
        
        .logout-btn:hover {
            background: #c53030;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .alert.success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        
        .alert.error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #feb2b2;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4299e1;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .auth-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🏗️ Permit Management System</h1>
            <p>Complete Florida County Permit Management with Authentication & File Uploads</p>
        </div>
        
        <!-- Alert Messages -->
        <div id="alert" class="alert"></div>
        
        <!-- Authentication Container -->
        <div id="auth-container" class="auth-container">
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="showAuthForm('login')">Login</button>
                <button class="auth-tab" onclick="showAuthForm('register')">Register</button>
            </div>
            
            <!-- Login Form -->
            <form id="login-form" class="auth-form active" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn">Login</button>
            </form>
            
            <!-- Register Form -->
            <form id="register-form" class="auth-form" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label for="register-firstName">First Name</label>
                    <input type="text" id="register-firstName" required>
                </div>
                <div class="form-group">
                    <label for="register-lastName">Last Name</label>
                    <input type="text" id="register-lastName" required>
                </div>
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Password</label>
                    <input type="password" id="register-password" required minlength="6">
                </div>
                <button type="submit" class="btn">Register</button>
            </form>
        </div>
        
        <!-- Main Content (Hidden until authenticated) -->
        <div id="main-content" class="main-content">
            <!-- User Info -->
            <div class="user-info">
                <h3>👤 User Information</h3>
                <div class="user-details">
                    <div class="user-detail">
                        <label>Name:</label>
                        <span id="user-name">-</span>
                    </div>
                    <div class="user-detail">
                        <label>Email:</label>
                        <span id="user-email">-</span>
                    </div>
                    <div class="user-detail">
                        <label>Role:</label>
                        <span id="user-role">-</span>
                    </div>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
            
            <!-- Dashboard -->
            <div class="dashboard">
                <div class="dashboard-card">
                    <h3>📊 System Overview</h3>
                    <p><strong>Total Counties:</strong> <span id="county-count">67</span></p>
                    <p><strong>Active Permits:</strong> <span id="active-permits">0</span></p>
                    <p><strong>Documents:</strong> <span id="document-count">0</span></p>
                </div>
                
                <div class="dashboard-card">
                    <h3>🔧 Quick Actions</h3>
                    <button class="btn btn-secondary" onclick="showCountySelector()">Select County</button>
                    <button class="btn btn-secondary" onclick="showFileUpload()">Upload Documents</button>
                    <button class="btn btn-secondary" onclick="showChecklist()">View Checklist</button>
                </div>
                
                <div class="dashboard-card">
                    <h3>📱 Mobile Access</h3>
                    <p>Native iOS & Android apps available</p>
                    <p>Offline functionality supported</p>
                    <p>Real-time synchronization</p>
                </div>
            </div>
            
            <!-- County Selector -->
            <div id="county-selector" class="county-selector" style="display: none;">
                <h3>🏛️ Select Florida County</h3>
                <select id="county-select" onchange="loadCountyChecklist()">
                    <option value="">Choose a county...</option>
                </select>
                <button class="btn" onclick="hideCountySelector()">Close</button>
            </div>
            
            <!-- Checklist Container -->
            <div id="checklist-container" class="checklist-container" style="display: none;">
                <h3>📋 Building Permit Checklist</h3>
                <div id="checklist-items"></div>
                <button class="btn btn-secondary" onclick="hideChecklist()">Close</button>
            </div>
            
            <!-- File Upload Container -->
            <div id="file-upload-container" class="file-upload-container" style="display: none;">
                <h3>📁 Document Upload</h3>
                <div class="file-upload-area" id="file-upload-area">
                    <p>📤 Drag and drop files here or click to browse</p>
                    <input type="file" id="file-input" multiple style="display: none;" onchange="handleFileSelect(event)">
                </div>
                <div class="file-list" id="file-list"></div>
                <button class="btn" onclick="uploadFiles()">Upload All Files</button>
                <button class="btn btn-secondary" onclick="hideFileUpload()">Close</button>
            </div>
        </div>
        
        <!-- Loading Spinner -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Loading...</p>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let authToken = null;
        let selectedFiles = [];
        let floridaCounties = [
            'Alachua County', 'Baker County', 'Bay County', 'Bradford County', 'Brevard County', 'Broward County',
            'Calhoun County', 'Charlotte County', 'Citrus County', 'Clay County', 'Collier County', 'Columbia County',
            'DeSoto County', 'Dixie County', 'Duval County', 'Escambia County', 'Flagler County', 'Franklin County',
            'Gadsden County', 'Gilchrist County', 'Glades County', 'Gulf County', 'Hamilton County', 'Hardee County',
            'Hendry County', 'Hernando County', 'Highlands County', 'Hillsborough County', 'Holmes County',
            'Indian River County', 'Jackson County', 'Jefferson County', 'Lafayette County', 'Lake County',
            'Lee County', 'Leon County', 'Levy County', 'Liberty County', 'Madison County', 'Manatee County',
            'Marion County', 'Martin County', 'Miami-Dade County', 'Monroe County', 'Nassau County',
            'Okaloosa County', 'Okeechobee County', 'Orange County', 'Osceola County', 'Palm Beach County',
            'Pasco County', 'Pinellas County', 'Polk County', 'Putnam County', 'Santa Rosa County',
            'Sarasota County', 'Seminole County', 'St. Johns County', 'St. Lucie County', 'Sumter County',
            'Suwannee County', 'Taylor County', 'Union County', 'Volusia County', 'Wakulla County',
            'Walton County', 'Washington County'
        ];

        // Standard checklist items for all counties
        const standardChecklist = [
            { title: 'Building Permit Application', description: 'Complete and signed building permit application form', required: true },
            { title: 'Site Plan', description: 'Site plan showing property boundaries and proposed construction', required: true },
            { title: 'Building Plans', description: 'Architectural plans including floor plans and elevations', required: true },
            { title: 'Structural Plans', description: 'Structural engineering plans if required', required: true },
            { title: 'Electrical Plans', description: 'Electrical plans and load calculations', required: true },
            { title: 'Plumbing Plans', description: 'Plumbing plans and fixture schedules', required: true },
            { title: 'Mechanical Plans', description: 'HVAC plans and equipment specifications', required: true },
            { title: 'Energy Code Compliance', description: 'Florida Energy Code compliance documentation', required: true },
            { title: 'Wind Load Compliance', description: 'Wind load calculations and hurricane compliance', required: true },
            { title: 'Zoning Compliance', description: 'Zoning verification and setback compliance', required: true },
            { title: 'Environmental Review', description: 'Environmental permits if construction affects sensitive areas', required: false },
            { title: 'Fire Department Review', description: 'Fire department plan review for commercial projects', required: false }
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            const savedToken = localStorage.getItem('authToken');
            const savedUser = localStorage.getItem('user');
            
            if (savedToken && savedUser) {
                authToken = savedToken;
                currentUser = JSON.parse(savedUser);
                showMainContent();
                populateCountySelect();
            }
            
            // Setup file upload area
            setupFileUpload();
        });

        // Authentication functions
        function showAuthForm(formType) {
            document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(formType + '-form').classList.add('active');
        }

        async function handleLogin(event) {
            event.preventDefault();
            showLoading(true);
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                const response = await fetch('/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    authToken = data.data.token;
                    currentUser = data.data.user;
                    
                    localStorage.setItem('authToken', authToken);
                    localStorage.setItem('user', JSON.stringify(currentUser));
                    
                    showAlert('Login successful!', 'success');
                    showMainContent();
                    populateCountySelect();
                } else {
                    showAlert(data.error || 'Login failed', 'error');
                }
            } catch (error) {
                showAlert('Network error. Please try again.', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            showLoading(true);
            
            const firstName = document.getElementById('register-firstName').value;
            const lastName = document.getElementById('register-lastName').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            
            try {
                const response = await fetch('/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ firstName, lastName, email, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('Registration successful! Please login.', 'success');
                    showAuthForm('login');
                } else {
                    showAlert(data.error || 'Registration failed', 'error');
                }
            } catch (error) {
                showAlert('Network error. Please try again.', 'error');
            } finally {
                showLoading(false);
            }
        }

        function logout() {
            authToken = null;
            currentUser = null;
            localStorage.removeItem('authToken');
            localStorage.removeItem('user');
            
            hideMainContent();
            showAlert('Logged out successfully', 'success');
        }

        // UI functions
        function showMainContent() {
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('main-content').classList.add('active');
            
            // Update user info
            if (currentUser) {
                document.getElementById('user-name').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
                document.getElementById('user-email').textContent = currentUser.email;
                document.getElementById('user-role').textContent = currentUser.role || 'User';
            }
        }

        function hideMainContent() {
            document.getElementById('auth-container').style.display = 'block';
            document.getElementById('main-content').classList.remove('active');
        }

        function populateCountySelect() {
            const select = document.getElementById('county-select');
            select.innerHTML = '<option value="">Choose a county...</option>';
            
            floridaCounties.forEach(county => {
                const option = document.createElement('option');
                option.value = county;
                option.textContent = county;
                select.appendChild(option);
            });
        }

        function showCountySelector() {
            document.getElementById('county-selector').style.display = 'block';
        }

        function hideCountySelector() {
            document.getElementById('county-selector').style.display = 'none';
        }

        function showChecklist() {
            document.getElementById('checklist-container').style.display = 'block';
        }

        function hideChecklist() {
            document.getElementById('checklist-container').style.display = 'none';
        }

        function showFileUpload() {
            document.getElementById('file-upload-container').style.display = 'block';
        }

        function hideFileUpload() {
            document.getElementById('file-upload-container').style.display = 'none';
        }

        function loadCountyChecklist() {
            const county = document.getElementById('county-select').value;
            if (!county) return;
            
            const checklistContainer = document.getElementById('checklist-items');
            checklistContainer.innerHTML = '';
            
            // Add county-specific header
            const header = document.createElement('h4');
            header.textContent = `${county} Building Permit Checklist`;
            header.style.marginBottom = '20px';
            header.style.color = '#2d3748';
            checklistContainer.appendChild(header);
            
            // Add checklist items
            standardChecklist.forEach((item, index) => {
                const checklistItem = document.createElement('div');
                checklistItem.className = 'checklist-item';
                checklistItem.innerHTML = `
                    <input type="checkbox" id="item-${index}" onchange="toggleChecklistItem(this)">
                    <div class="checklist-item-content">
                        <div class="checklist-item-title">${item.title}</div>
                        <div class="checklist-item-description">${item.description}</div>
                    </div>
                `;
                checklistContainer.appendChild(checklistItem);
            });
            
            showChecklist();
        }

        function toggleChecklistItem(checkbox) {
            const item = checkbox.closest('.checklist-item');
            if (checkbox.checked) {
                item.classList.add('completed');
            } else {
                item.classList.remove('completed');
            }
        }

        // File upload functions
        function setupFileUpload() {
            const uploadArea = document.getElementById('file-upload-area');
            const fileInput = document.getElementById('file-input');
            
            uploadArea.addEventListener('click', () => fileInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });
        }

        function handleFileSelect(event) {
            handleFiles(event.target.files);
        }

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (!selectedFiles.find(f => f.name === file.name)) {
                    selectedFiles.push(file);
                    displayFile(file);
                }
            });
        }

        function displayFile(file) {
            const fileList = document.getElementById('file-list');
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                <div class="file-info">
                    <div class="file-icon">${getFileIcon(file.name)}</div>
                    <div class="file-details">
                        <h4>${file.name}</h4>
                        <p>${formatFileSize(file.size)} • ${file.type || 'Unknown type'}</p>
                    </div>
                </div>
                <div class="file-actions">
                    <button onclick="removeFile('${file.name}')">Remove</button>
                </div>
            `;
            fileList.appendChild(fileItem);
        }

        function removeFile(fileName) {
            selectedFiles = selectedFiles.filter(f => f.name !== fileName);
            updateFileList();
        }

        function updateFileList() {
            const fileList = document.getElementById('file-list');
            fileList.innerHTML = '';
            selectedFiles.forEach(file => displayFile(file));
        }

        function getFileIcon(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            if (['pdf'].includes(ext)) return 'PDF';
            if (['doc', 'docx'].includes(ext)) return 'DOC';
            if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) return 'IMG';
            if (['dwg', 'dxf'].includes(ext)) return 'CAD';
            return 'FILE';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function uploadFiles() {
            if (selectedFiles.length === 0) {
                showAlert('No files selected', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                const formData = new FormData();
                selectedFiles.forEach(file => {
                    formData.append('files', file);
                });
                
                const response = await fetch('/documents/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('Files uploaded successfully!', 'success');
                    selectedFiles = [];
                    updateFileList();
                } else {
                    showAlert(data.error || 'Upload failed', 'error');
                }
            } catch (error) {
                showAlert('Upload failed. Please try again.', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Utility functions
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert ${type}`;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
    </script>
</body>
</html>

